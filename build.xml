<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
  build.xml

  This work is free software; you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published
  by the Free Software Foundation; either version 2 of the License,
  or (at your option) any later version.

  This work is distributed in the hope that it will be useful, but
  WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program; if not, write to the Free Software
  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
  USA

  Copyright (c) 2004 Per Cederberg. All rights reserved.
-->

<project name="mibble" default="package" basedir=".">

<!-- INITIALIZATION -->
  <target name="init">
    <tstamp />
    <condition property="build.version" value="${DSTAMP}">
      <not>
        <isset property="build.version" />
      </not>
    </condition>
  </target>


<!-- PACKAGING TARGETS -->
  <target name="package"
          depends="init,package-clean,package-public" />

  <target name="package-clean">
    <delete>
      <fileset dir="."
               includes="mibble-*.tar.gz" />
    </delete>
  </target>

  <target name="package-public">
    <property name="build.name" value="mibble" />
    <copy file="LICENSE-GPL.txt"
          tofile="LICENSE.txt"
          overwrite="true" />
    <ant antfile="compile.xml" target="minimal" />
    <tar tarfile="${build.name}-${build.version}.tar.gz"
         longfile="gnu"
         compression="gzip">
      <tarfileset dir="."
                  fullpath="${build.name}-${build.version}/build.xml"
                  includes="compile.xml" />
      <tarfileset dir="."
                  prefix="${build.name}-${build.version}">
        <include name="README.txt" />
        <include name="LICENSE.txt" />
        <include name="bin/*.bat" />
<!-- TODO: limit to only needed libs -->
        <include name="lib/**" />
        <include name="src/**" />
        <include name="doc/**" />
      </tarfileset>
      <tarfileset dir="."
                  prefix="${build.name}-${build.version}"
                  mode="777"
                  includes="bin/*.sh" />
    </tar>
    <delete file="LICENSE.txt" />
  </target>

</project>
